<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew Mertens">

<title>Danish registry analyses LTMLE specifications - treatment gap</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="example_LTMLE_specifications_treatment_holiday_files/libs/clipboard/clipboard.min.js"></script>
<script src="example_LTMLE_specifications_treatment_holiday_files/libs/quarto-html/quarto.js"></script>
<script src="example_LTMLE_specifications_treatment_holiday_files/libs/quarto-html/popper.min.js"></script>
<script src="example_LTMLE_specifications_treatment_holiday_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="example_LTMLE_specifications_treatment_holiday_files/libs/quarto-html/anchor.min.js"></script>
<link href="example_LTMLE_specifications_treatment_holiday_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="example_LTMLE_specifications_treatment_holiday_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="example_LTMLE_specifications_treatment_holiday_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="example_LTMLE_specifications_treatment_holiday_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="example_LTMLE_specifications_treatment_holiday_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Danish registry analyses LTMLE specifications - treatment gap</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrew Mertens </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="the-research-question" class="level3">
<h3 class="anchored" data-anchor-id="the-research-question">1) The Research Question</h3>
<p>What is the effect of the 5 year usage of the 2nd line diabetes drug GLP1 (with imperfect adherence) on dementia cumulative incidence, compared to the 5 year usage of the 2nd line diabetes drug SGLT2 (with imperfect adherence) on dementia cumulative incidence</p>
</section>
<section id="the-causal-model" class="level3">
<h3 class="anchored" data-anchor-id="the-causal-model">2) The Causal Model</h3>
<ul>
<li>Baseline covariates <span class="math inline">\(W_{baseline}\)</span>: age, sex, wealth</li>
<li>Longitudinal covariates <span class="math inline">\(L\)</span> (subset of <span class="math inline">\(W\)</span>: Insulin, hypertension, and 2nd line diabetes drugs not a part of the treatment regime, death</li>
</ul>
<p><span class="math display">\[
W=f_W(U_W)
\]</span></p>
<ul>
<li>Treatment <span class="math inline">\(A\)</span>: GlP1 usage (A1_t=1) with one-node gaps allowed (treatment holiday) vs SGLT2 usage (A2_t=1) with one-node gaps allowed (treatment holiday)</li>
</ul>
<p><span class="math display">\[
A=f_A(W, U_A)
\]</span></p>
<ul>
<li>Outcome <span class="math inline">\(Y\)</span>: dementia incidence</li>
</ul>
<p><span class="math display">\[
Y=f_Y(W,A,U_Y)
\]</span></p>
</section>
<section id="the-causal-parameter" class="level3">
<h3 class="anchored" data-anchor-id="the-causal-parameter">3) The Causal Parameter</h3>
<p>The relative 5-year risk in dementia between GLP1 users and SGLT2 users:</p>
<p><span class="math display">\[\frac{E[Y_{\bar{a}_1=1,\bar{a}_2=0, c=0}]}{E[Y_{\bar{a}_1=0,\bar{a}_2=1, c=0}]}\]</span></p>
</section>
<section id="observed-data-and-statistical-model" class="level3">
<h3 class="anchored" data-anchor-id="observed-data-and-statistical-model">4) Observed Data and Statistical Model</h3>
<p>Data from this cohort can be described by a general longitudinal data structure, denoted as:</p>
<p><span class="math display">\[ O = (W, A(1), ..., L(K), A(K), L(K+1)) \sim  P_0 \in  M   \]</span></p>
<p>where W denotes baseline (time-invariant) covariate information, and <span class="math inline">\(A(1)\)</span> is exposure status at the beginning of the first node or time interval (i.e.&nbsp;index date). <span class="math inline">\(A\)</span> nodes also include an administrative censoring mechanism, C, which denotes censoring during the time interval. For ease of notation above, we refer to the treatment and censoring processes together as <span class="math inline">\(A(t)=(A_1(t), A_2(t), C(t))\)</span>. We refer to the covariate and outcome nodes collectively as <span class="math inline">\(L(t)=(L(t), Y(t))\)</span>, which includes both time-varying covariate information <span class="math inline">\(L(t)\)</span> and outcome information <span class="math inline">\(Y(t)\)</span>. Death will be considered a competing risk in the primary analyses and is thus also included in <span class="math inline">\(L(t)\)</span>. Index date and baseline measurements are measured at the date of switch to second-line regimen. Here we use a 6-month time scale for time increments in the main analyses. <span class="math inline">\(K+1\)</span> is defined as the maximum follow up time.</p>
<section id="glimpse-of-simulated-data" class="level4">
<h4 class="anchored" data-anchor-id="glimpse-of-simulated-data">Glimpse of simulated data:</h4>
<p>Note in the real analysis, k=10 for the full 5-year followup with 6-month time nodes, but here we use 3 time nodes for simplicity.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   age_base sex    ie.type quartile_income insulin_0 hypertension_0 glp1_0
1: 63.73899   0 -0.3260365       0.7032476         0              0      1
2: 85.62075   1  0.5524619      -0.7747945         0              1      0
3: 64.44215   1 -0.6749438      -1.0302495         0              0      0
   sglt2_inhib_0 other_drugs_0 event_dementia_0 censor_0 event_death_0
1:             0             0                0        0             0
2:             0             1                0        0             0
3:             0             0                0        0             0
   insulin_1 hypertension_1 renal.disease_1 glp1_1 sglt2_inhib_1 other_drugs_1
1:         0              0               0      1             0             0
2:         0              1               0      0             0             1
3:         0              0               0      0             0             0
   event_dementia_1 censor_1 event_death_1 insulin_2 hypertension_2 glp1_2
1:                0        0             0         0              0      0
2:                0        0             0         0              1      0
3:                0        0             0         0              0      0
   sglt2_inhib_2 other_drugs_2 event_dementia_2 censor_2 event_death_2
1:             0             0                0        1             0
2:             0             1                0        0             0
3:             0             0                0        0             0
   insulin_3 hypertension_3 glp1_3 sglt2_inhib_3 other_drugs_3 event_dementia_3
1:         0              0      0             0             0                0
2:         0              1      0             0             1                0
3:         0              0      0             0             0                0
   censor_3 event_death_3 event_dementia_4
1:        1             0                0
2:        0             0                0
3:        1             0                0</code></pre>
</div>
</div>
</section>
</section>
<section id="identification-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="identification-assumptions">5) Identification assumptions</h3>
<ul>
<li>temporality</li>
<li>no interference</li>
<li>consistency</li>
</ul>
</section>
<section id="statistical-estimation-and-inference" class="level3">
<h3 class="anchored" data-anchor-id="statistical-estimation-and-inference">6) Statistical Estimation and Inference</h3>
<ul>
<li>GLM for estimation</li>
</ul>
<section id="specification-of-the-nodes-passed-to-the-lmtle-call" class="level4">
<h4 class="anchored" data-anchor-id="specification-of-the-nodes-passed-to-the-lmtle-call">Specification of the nodes passed to the LMTLE call:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age_base"</span>,<span class="st">"sex"</span>, <span class="st">"quartile_income"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>long_covariates <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"insulin_"</span>,<span class="st">"hypertension_"</span>,<span class="st">"other_drugs_"</span>, <span class="st">"event_death_"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>spec_ltmle <span class="ot">&lt;-</span> <span class="fu">spec_analysis</span>(<span class="at">data=</span>d, long_covariates, baseline_vars,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N_time=</span><span class="dv">4</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Avars=</span><span class="fu">c</span>(<span class="st">"glp1_"</span>,<span class="st">"sglt2_inhib_"</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Yvars=</span><span class="fu">c</span>(<span class="st">"event_dementia_"</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Cvars=</span><span class="fu">c</span>(<span class="st">"censor_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Specifying {A} to allow 1-node treatment gaps:</strong></p>
<p>Below is an R function to add treatment gaps in {A} specification, where <span class="math inline">\(A_1(k)\)</span> (the intervention arm of GLP1) is intervened upon to start on GLP1 (<span class="math inline">\(A_1(1)==1\)</span>) and individuals remain on the drug but allowing for small treatment gaps and remaining n In the reference arm, the specification is reversed, where <span class="math inline">\(A_2(k)\)</span> is set to allow small gaps and <span class="math inline">\(A_1(k)\)</span> is set to 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>spec_Abar_with_treatment_holiday <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data, <span class="at">A_nodes=</span>spec_ltmle<span class="sc">$</span>Anodes, <span class="at">intervention_nodes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">control_nodes=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  A_df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>(A_nodes)) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Make matrices of size A_nodes X N_subjects for the intervention and control regimes</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  abar_gap1 <span class="ot">=</span> abar_gap2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(A_df),<span class="at">ncol=</span><span class="fu">ncol</span>(A_df))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set first intervention node to one for all: hypothetical trial where all start on drug</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,intervention_nodes[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set all control arm drug nodes to 0</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,control_nodes] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set 2nd intervention node to the observed: hypothetical trial where all start on drug (1st node)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#but gaps up to one node are allowed so the 2nd node can be the observed value of A</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,<span class="dv">3</span>] <span class="ot">=</span> A_df[,<span class="dv">3</span>]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#for the third node onward, set to: </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="fu">length</span>(intervention_nodes)){</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) observed if previously treated (A_t=a|A_(t-1)=1)</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      abar_gap1[abar_gap1[,intervention_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">1</span>, intervention_nodes[i]] <span class="ot">=</span> A_df[abar_gap1[,intervention_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">1</span>, intervention_nodes[i]]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) treated if previously not treated (A_t=1|A_(t-1)=0) </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      abar_gap1[abar_gap1[,intervention_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">0</span>, intervention_nodes[i]] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#now repeat the process for the control regime</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,control_nodes[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,intervention_nodes] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,control_nodes[<span class="dv">2</span>]] <span class="ot">=</span> A_df[,control_nodes[<span class="dv">2</span>]]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="fu">length</span>(control_nodes)){</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) observed if previously treated (A_t=a|A_(t-1)=1)</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      abar_gap2[abar_gap2[,control_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">1</span>, control_nodes[i]] <span class="ot">=</span> A_df[abar_gap2[,control_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">1</span>, control_nodes[i]]</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) treated if previously not treated (A_t=1|A_(t-1)=0) </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      abar_gap2[abar_gap2[,control_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">0</span>, control_nodes[i]] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  abar_gap<span class="ot">=</span><span class="fu">list</span>(abar_gap1, abar_gap2)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(abar_gap)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-up-contrast-between-glp1-usage-with-gaps-and-no-sglt2-usage-vs.-sglt2-usage-with-gaps-and-no-glp1-usage" class="level4">
<h4 class="anchored" data-anchor-id="set-up-contrast-between-glp1-usage-with-gaps-and-no-sglt2-usage-vs.-sglt2-usage-with-gaps-and-no-glp1-usage">Set up contrast between GLP1 usage with gaps and no SGLT2 usage VS. SGLT2 usage with gaps and no GLP1 usage</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>abar_gap<span class="ot">=</span> <span class="fu">spec_Abar_with_treatment_holiday</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">A_nodes=</span>spec_ltmle<span class="sc">$</span>Anodes, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">intervention_nodes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">control_nodes=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Examine examples of 2 different intervention regimes, comparing observed data and treatment regimes that match the observed data as close as possible while intervening to start on the GLP1 drug of interest, intervening to avoid gaps in treatment longer than 1 node (6 months), and intervening to prevent SGLT2 use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>spec_ltmle<span class="sc">$</span>data  <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>(spec_ltmle<span class="sc">$</span>Anodes)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   glp1_1 sglt2_inhib_1 glp1_2 sglt2_inhib_2 glp1_3 sglt2_inhib_3
1:      1             0      0             0      0             0
2:      0             0      0             0      0             0
3:      0             0      1             0      0             0
4:      1             0      1             0      1             0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>abar_gap[[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">9</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    0    0    0    1    0
[2,]    1    0    0    0    1    0
[3,]    1    0    1    0    0    0
[4,]    1    0    1    0    1    0</code></pre>
</div>
</div>
<p>Example reference regime (SGLT2 use with gaps, no GLP1 use):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(abar_gap[[<span class="dv">2</span>]],<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    0    1    0    0    0    1
[2,]    0    1    0    0    0    1
[3,]    0    1    0    0    0    1</code></pre>
</div>
</div>
</section>
<section id="run-analysis" class="level4">
<h4 class="anchored" data-anchor-id="run-analysis">Run analysis</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>   res_RR <span class="ot">&lt;-</span> <span class="fu">ltmle</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Anodes =</span> spec_ltmle<span class="sc">$</span>Anodes,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Cnodes =</span> spec_ltmle<span class="sc">$</span>Cnodes,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Lnodes =</span> spec_ltmle<span class="sc">$</span>Lnodes,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Ynodes =</span> spec_ltmle<span class="sc">$</span>Ynodes,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">survivalOutcome =</span> T,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">abar =</span> abar_gap,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SL.library =</span> <span class="st">"glm"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variance.method =</span> <span class="st">"ic"</span> )</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">summary</span>(res_RR)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5837859</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5%    97.5%
[1,] 0.009310536 36.60434</code></pre>
</div>
</div>
</section>
<section id="alternative-1-setting-a_bar-to-continious-usage-except-for-when-the-observed-data-has-small-allowable-gaps" class="level4">
<h4 class="anchored" data-anchor-id="alternative-1-setting-a_bar-to-continious-usage-except-for-when-the-observed-data-has-small-allowable-gaps">Alternative 1: Setting A_bar to continious usage, except for when the observed data has small, allowable gaps</h4>
<p>Above, we set <span class="math inline">\(\bar{A}\)</span> as close as possible to the observed data for</p>
<p>If observed GLP1 is for t=1,2,3 is 0,0,0, then <span class="math inline">\(\bar{A}\)</span> is set to 1,0,1</p>
<p>In the real analysis (10 time nodes), where the majority of people are not using GLP1, that means the majority of <span class="math inline">\(\bar{A} = 1,0,1,0,1,0,1,0,1,0\)</span></p>
<p>Does it make more sense to set <span class="math inline">\(\bar{A} = 1,1,1,1,1,1,1,1,1,1\)</span> for all individuals whose observed data does not match a regime with allowable (1-node) gaps in GLP1 usage, and set <span class="math inline">\(\bar{A}\)</span> to the observed <span class="math inline">\(A\)</span> when the observed <span class="math inline">\(A\)</span> fits an allowable regime?</p>
<p>This would then use more GLP1 users’ data in estimating dementia risk, while still emulating an ideal trial where individuals continiously use the drug but adherence is imperfect.</p>
<p>I’ve implemented this below to compare effect of the estimated relative risk.</p>
<p>But maybe I’m not understanding what LTMLE is doing when each individual has a different <span class="math inline">\(\bar{A}\)</span>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>spec_Abar_with_treatment_holiday_alt <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data, <span class="at">A_nodes=</span>spec_ltmle<span class="sc">$</span>Anodes, <span class="at">intervention_nodes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">control_nodes=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  A_df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>(A_nodes)) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Make matrices of size A_nodes X N_subjects for the intervention and control regimes using observed data</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  abar_gap1 <span class="ot">=</span> abar_gap2 <span class="ot">=</span> A_df</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set first intervention node to one for all: hypothetical trial where all start on drug</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,intervention_nodes[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,control_nodes[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set all control arm drug nodes to 0</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,control_nodes] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,intervention_nodes] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">#Set intervention nodes to 1, unless observed data matches the ideal treatment regimes (continious usage with short gaps)</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  is_following_regime<span class="ot">=</span><span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="fu">nrow</span>(abar_gap1))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(intervention_nodes)){</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    is_following_regime<span class="ot">=</span><span class="fu">ifelse</span>(A_df[intervention_nodes[<span class="dv">1</span>]]<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span>(A_df[,intervention_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> A_df[,intervention_nodes[i]]<span class="sc">==</span><span class="dv">0</span>), is_following_regime,F)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  abar_gap1[is_following_regime, intervention_nodes] <span class="ot">&lt;-</span> A_df[is_following_regime, intervention_nodes]</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  abar_gap1[<span class="sc">!</span>is_following_regime, intervention_nodes] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  is_following_control<span class="ot">=</span><span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="fu">nrow</span>(abar_gap2))</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(control_nodes)){</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    is_following_control<span class="ot">=</span><span class="fu">ifelse</span>(A_df[control_nodes[<span class="dv">1</span>]]<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span>(A_df[,control_nodes[i<span class="dv">-1</span>]]<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> A_df[,control_nodes[i]]<span class="sc">==</span><span class="dv">0</span>), is_following_control,F)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  abar_gap2[is_following_control, control_nodes] <span class="ot">&lt;-</span> A_df[is_following_control, control_nodes]</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  abar_gap2[<span class="sc">!</span>is_following_control, control_nodes] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  abar_gap<span class="ot">=</span><span class="fu">list</span>(<span class="fu">as.matrix</span>(abar_gap1), <span class="fu">as.matrix</span>(abar_gap2))</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(abar_gap)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>abar_spec_alt <span class="ot">=</span> <span class="fu">spec_Abar_with_treatment_holiday_alt</span>()</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co">#show a few different regimes, compared to real data:</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>spec_ltmle<span class="sc">$</span>data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>(spec_ltmle<span class="sc">$</span>Anodes)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   glp1_1 sglt2_inhib_1 glp1_2 sglt2_inhib_2 glp1_3 sglt2_inhib_3
1:      1             0      0             0      0             0
2:      0             0      0             0      0             0
3:      1             0      1             0      0             0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>abar_spec_alt[[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">100</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     glp1_1 sglt2_inhib_1 glp1_2 sglt2_inhib_2 glp1_3 sglt2_inhib_3
[1,]      1             0      1             0      1             0
[2,]      1             0      1             0      1             0
[3,]      1             0      1             0      0             0</code></pre>
</div>
</div>
</section>
<section id="run-analysis-1" class="level4">
<h4 class="anchored" data-anchor-id="run-analysis-1">Run analysis</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>   res_RR <span class="ot">&lt;-</span> <span class="fu">ltmle</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Anodes =</span> spec_ltmle<span class="sc">$</span>Anodes,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Cnodes =</span> spec_ltmle<span class="sc">$</span>Cnodes,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Lnodes =</span> spec_ltmle<span class="sc">$</span>Lnodes,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Ynodes =</span> spec_ltmle<span class="sc">$</span>Ynodes,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">survivalOutcome =</span> T,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">abar =</span> abar_spec_alt,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SL.library =</span> <span class="st">"glm"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variance.method =</span> <span class="st">"ic"</span> )</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">summary</span>(res_RR)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5811694</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5%    97.5%
[1,] 0.009394263 35.95363</code></pre>
</div>
</div>
</section>
<section id="alternative-2-deterministic-g-function" class="level4">
<h4 class="anchored" data-anchor-id="alternative-2-deterministic-g-function">Alternative 2: deterministic g function</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#specify the intervened treatment</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>abar_spec <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="dv">3</span>),<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dv">3</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>abar_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 0 1 0 1 0

[[2]]
[1] 0 1 0 1 0 1</code></pre>
</div>
</div>
<p>This deterministic g function is the equivalent logic of the spec_Abar_with_treatment_holiday() function, but applied as determistic knowledge (which feels wrong to me, but was the approach recommended by Zeyi):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>SI_function1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, current.node, nodes) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if not an A node, then skip</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if there is no previous node, then treat as usual</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  Anodes <span class="ot">&lt;-</span> nodes<span class="sc">$</span>A</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(current.node <span class="sc">%in%</span> Anodes)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">any</span>(Anodes <span class="sc">&lt;</span> current.node))) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if t-1 for the specific A node is treated, then deterministically set to be the observed value; (when observed value is not NA)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prob1 is the prob of being 1, equal to obs value here: observed 1, set a^d_t = obs value with prob 1; observed 0, set a^d_t = obs value with prob 0</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if t-1 is not treated, then treat as usual (not deterministic)</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#note that t-1 for a specific type of A is t-4 when there are 4 types of treatments (-3 from the max index of previous Anodes)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get Anodes prior to current.node</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  prev.a.node <span class="ot">&lt;-</span> <span class="fu">max</span>(Anodes[Anodes <span class="sc">&lt;</span> current.node])</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  is.deterministic <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(data[, current.node]) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(prev.a.node), data[, prev.a.node] <span class="sc">==</span> <span class="dv">1</span>, F)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  prob1 <span class="ot">&lt;-</span> data[, current.node][is.deterministic]</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">is.deterministic=</span>is.deterministic, <span class="at">prob1=</span>prob1))</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>   res_RR <span class="ot">&lt;-</span> <span class="fu">ltmle</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Anodes =</span> spec_ltmle<span class="sc">$</span>Anodes,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Cnodes =</span> spec_ltmle<span class="sc">$</span>Cnodes,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Lnodes =</span> spec_ltmle<span class="sc">$</span>Lnodes,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Ynodes =</span> spec_ltmle<span class="sc">$</span>Ynodes,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">survivalOutcome =</span> T,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">abar =</span> abar_spec,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">deterministic.g.function =</span> SI_function1,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SL.library =</span> <span class="st">"glm"</span>,</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variance.method =</span> <span class="st">"ic"</span> )</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">summary</span>(res_RR)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6693092</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           2.5%    97.5%
[1,] 0.01614784 27.74208</code></pre>
</div>
</div>
</section>
<section id="sensitivity-analysis-continious-usage-no-treatment-holidays" class="level4">
<h4 class="anchored" data-anchor-id="sensitivity-analysis-continious-usage-no-treatment-holidays">Sensitivity analysis: continious usage (no treatment holidays)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>   res_RR <span class="ot">&lt;-</span> <span class="fu">ltmle</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Anodes =</span> spec_ltmle<span class="sc">$</span>Anodes,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Cnodes =</span> spec_ltmle<span class="sc">$</span>Cnodes,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Lnodes =</span> spec_ltmle<span class="sc">$</span>Lnodes,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Ynodes =</span> spec_ltmle<span class="sc">$</span>Ynodes,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">survivalOutcome =</span> T,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">abar =</span> abar_spec,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SL.library =</span> <span class="st">"glm"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variance.method =</span> <span class="st">"ic"</span> )</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">summary</span>(res_RR)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.57511</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5%    97.5%
[1,] 0.009630054 34.34576</code></pre>
</div>
</div>
</section>
</section>
<section id="interpretation-of-results" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-results">7) Interpretation of Results</h3>
<p>The deterministic g function leads to an estimate further from the “no treatment holiday” analysis than by manually specifying <span class="math inline">\(\bar{A}\)</span> to allow gaps.</p>
<p>Is the correct interpretation of the regime allowing gaps the following?</p>
<p>“The cumulative risk of dementia in GLP1 users, allowing for small gaps reflective of real world usage, is 0.575 times the risk in SGLT2 users with the same realistic usage”</p>
</section>
<section id="appendix-more-complicated-comparison-of-dual-treatment-regimes." class="level3">
<h3 class="anchored" data-anchor-id="appendix-more-complicated-comparison-of-dual-treatment-regimes.">Appendix: More complicated comparison of dual treatment regimes.</h3>
<p>I think this is how to code the analysis Thomas is working on, contrasting the dual usage of two 2nd-line diabetes drugs (with treatment holidays allowed) against the dual usage of two different 2nd-line diabetes drugs (with treatment holidays allowed).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>long_covariates <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"insulin_"</span>,<span class="st">"hypertension_"</span>, <span class="st">"event_death_"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Make mock DPP4 drug for purposes of contrasting 4 drugs</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>dpp4_0 <span class="ot">&lt;-</span> d<span class="sc">$</span>dpp4_1 <span class="ot">&lt;-</span> d<span class="sc">$</span>dpp4_2 <span class="ot">&lt;-</span> d<span class="sc">$</span>dpp4_3 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(d),<span class="dv">1</span>, <span class="fl">0.1</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#specify LTMLE analysis</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>spec_ltmle <span class="ot">&lt;-</span> <span class="fu">spec_analysis</span>(<span class="at">data=</span>d, long_covariates, baseline_vars, </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N_time=</span><span class="dv">4</span>, <span class="at">Avars=</span><span class="fu">c</span>(<span class="st">"glp1_"</span>,<span class="st">"sglt2_inhib_"</span>,<span class="st">"dpp4_"</span>,<span class="st">"other_drugs_"</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Yvars=</span><span class="fu">c</span>(<span class="st">"event_dementia_"</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Cvars=</span><span class="fu">c</span>(<span class="st">"censor_"</span>))</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#update function to allow for multiple drugs in each arm (new argument `n_drugs_per_arm`)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>spec_dual_Abar_with_treatment_holiday <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data, <span class="at">A_nodes=</span>spec_ltmle<span class="sc">$</span>Anodes, <span class="at">intervention_nodes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">10</span>), <span class="at">control_nodes=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>), <span class="at">n_drugs_per_arm=</span><span class="dv">2</span>){</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a> A_df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>(A_nodes)) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Make matrices of size A_nodes X N_subjects for the intervention and control regimes</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  abar_gap1 <span class="ot">=</span> abar_gap2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(A_df),<span class="at">ncol=</span><span class="fu">ncol</span>(A_df))</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set first intervention node to one for all: hypothetical trial where all start on drug</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,intervention_nodes[<span class="dv">1</span><span class="sc">:</span>n_drugs_per_arm]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set all control arm drug nodes to 0</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  abar_gap1[,control_nodes] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set 2nd intervention node to the observed: hypothetical trial where all start on drug (1st node)</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#but gaps up to one node are allowed so the 2nd node can be the observed value of A</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_drugs_per_arm){</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>      abar_gap1[,intervention_nodes[i<span class="sc">+</span>n_drugs_per_arm]] <span class="ot">=</span> A_df[,intervention_nodes[i<span class="sc">+</span>n_drugs_per_arm]]</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#for the third node onward, set to: </span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> (<span class="dv">2</span><span class="sc">*</span>n_drugs_per_arm<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(intervention_nodes)){</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) observed if previously treated (Aj_t=a|Aj_(t-1)=1)</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      abar_gap1[abar_gap1[,intervention_nodes[i<span class="sc">-</span>n_drugs_per_arm]]<span class="sc">==</span><span class="dv">1</span>, intervention_nodes[i]] <span class="ot">=</span> A_df[abar_gap1[,intervention_nodes[i<span class="sc">-</span>n_drugs_per_arm]]<span class="sc">==</span><span class="dv">1</span>, intervention_nodes[i]]</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) treated if previously not treated (Aj_t=1|Aj_(t-1)=0) </span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>      abar_gap1[abar_gap1[,intervention_nodes[i<span class="sc">-</span>n_drugs_per_arm]]<span class="sc">==</span><span class="dv">0</span>, intervention_nodes[i]] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#now repeat the process for the control regime</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,control_nodes[<span class="dv">1</span><span class="sc">:</span>n_drugs_per_arm]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  abar_gap2[,intervention_nodes] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_drugs_per_arm){</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>      abar_gap2[,control_nodes[i<span class="sc">+</span>n_drugs_per_arm]] <span class="ot">=</span> A_df[,control_nodes[i<span class="sc">+</span>n_drugs_per_arm]]</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> (<span class="dv">2</span><span class="sc">*</span>n_drugs_per_arm<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(control_nodes)){</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) observed if previously treated (A_t=a|A_(t-1)=1)</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>      abar_gap2[abar_gap2[,control_nodes[i<span class="sc">-</span>n_drugs_per_arm]]<span class="sc">==</span><span class="dv">1</span>, control_nodes[i]] <span class="ot">=</span> A_df[abar_gap2[,control_nodes[i<span class="sc">-</span>n_drugs_per_arm]]<span class="sc">==</span><span class="dv">1</span>, control_nodes[i]]</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) treated if previously not treated (A_t=1|A_(t-1)=0) </span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>      abar_gap2[abar_gap2[,control_nodes[i<span class="sc">-</span>n_drugs_per_arm]]<span class="sc">==</span><span class="dv">0</span>, control_nodes[i]] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>   abar_gap<span class="ot">=</span><span class="fu">list</span>(abar_gap1, abar_gap2)</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(abar_gap)</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>}  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="specify-dual-treatments" class="level4">
<h4 class="anchored" data-anchor-id="specify-dual-treatments">Specify dual treatments:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dual_abar_gap<span class="ot">=</span> <span class="fu">spec_dual_Abar_with_treatment_holiday</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">A_nodes=</span>spec_ltmle<span class="sc">$</span>Anodes, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">intervention_nodes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">10</span>), </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">control_nodes=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>), </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">n_drugs_per_arm=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Examine examples of 2 different regimes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#intervention arm</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dual_abar_gap[[<span class="dv">1</span>]],<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]
[1,]    1    1    0    0    0    0    0    0    1     1     0     0
[2,]    1    1    0    0    0    0    0    0    1     1     0     0
[3,]    1    1    0    0    0    0    0    0    1     1     0     0
[4,]    1    1    0    0    1    0    0    0    0     1     0     0
[5,]    1    1    0    0    0    0    0    0    1     1     0     0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reference arm</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dual_abar_gap[[<span class="dv">2</span>]],<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]
[1,]    0    0    1    1    0    0    0    0    0     0     1     1
[2,]    0    0    1    1    0    0    0    1    0     0     1     1
[3,]    0    0    1    1    0    0    0    0    0     0     1     1
[4,]    0    0    1    1    0    0    0    1    0     0     1     1
[5,]    0    0    1    1    0    0    0    0    0     0     1     1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>   res_dual <span class="ot">&lt;-</span> <span class="fu">ltmle</span>(<span class="at">data=</span>spec_ltmle<span class="sc">$</span>data,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Anodes =</span> spec_ltmle<span class="sc">$</span>Anodes,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Cnodes =</span> spec_ltmle<span class="sc">$</span>Cnodes,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Lnodes =</span> spec_ltmle<span class="sc">$</span>Lnodes,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Ynodes =</span> spec_ltmle<span class="sc">$</span>Ynodes,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">survivalOutcome =</span> T,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">abar =</span> dual_abar_gap,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SL.library =</span> <span class="st">"glm"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variance.method =</span> <span class="st">"ic"</span> )</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">summary</span>(res_dual)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.721185</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>effect.measures<span class="sc">$</span>RR<span class="sc">$</span>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             2.5%    97.5%
[1,] 7.295275e-05 619227.2</code></pre>
</div>
</div>
<p>Hopefully, extreme CI’s are from positivity issues or unrealistic data plus the rare outcome in the small (n=1000) simulated dataset used here.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>